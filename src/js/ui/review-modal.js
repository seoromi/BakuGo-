document.addEventListener("DOMContentLoaded",function(){window.openReviewModal=function(){const e=document.getElementById("reviewModal");e&&(e.style.display="flex",e.setAttribute("aria-hidden","false"),document.body.style.overflow="hidden",o("experienceSelection"))};const e=document.getElementById("reviewModalClose");e&&e.addEventListener("click",function(){n()});const t=document.getElementById("cancelReview");function n(){const e=document.getElementById("reviewModal");if(e){e.style.display="none",e.setAttribute("aria-hidden","true"),document.body.style.overflow="auto";const t=document.getElementById("reviewForm");t&&t.reset(),i.length>0&&a&&(i.forEach(e=>e.classList.remove("active")),a.textContent="Выберите оценку",r&&(r.value=""))}}function o(e){document.querySelectorAll(".review-screen").forEach(e=>{e.classList.remove("active")});const t=document.getElementById(e);t&&t.classList.add("active")}t&&t.addEventListener("click",function(){n()}),window.showExperienceSelection=function(){o("experienceSelection")},window.showLikeOptions=function(){o("likeOptions")},window.showFeedbackForm=function(){o("feedbackForm")},window.openTripadvisorReview=function(){window.open("https://www.tripadvisor.com/Attraction_Review-g293934-d12345678-Reviews-BakuGo_Tour-Baku_Absheron_Region.html","_blank"),d("positive","tripadvisor"),setTimeout(()=>{n()},1e3)},window.openGoogleReview=function(){window.open("https://search.google.com/local/writereview?placeid=YOUR_GOOGLE_PLACE_ID","_blank"),d("positive","google"),setTimeout(()=>{n()},1e3)};const i=document.querySelectorAll(".star"),r=document.getElementById("rating"),a=document.getElementById("ratingText");if(i.length>0&&r&&a){i.forEach(e=>{e.addEventListener("click",function(){const e=this.getAttribute("data-rating");r.value=e,i.forEach((t,n)=>{n<e?t.classList.add("active"):t.classList.remove("active")});a.textContent={1:"Ужасно",2:"Плохо",3:"Нормально",4:"Хорошо",5:"Отлично"}[e]}),e.addEventListener("mouseenter",function(){const e=this.getAttribute("data-rating");i.forEach((t,n)=>{n<e?t.classList.add("hover"):t.classList.remove("hover")})})});const e=document.getElementById("ratingStars");e&&e.addEventListener("mouseleave",function(){i.forEach(e=>e.classList.remove("hover"))})}const c=document.getElementById("reviewTour");c&&c.addEventListener("change",function(){const e=document.getElementById("customTourGroup");e&&("other"===this.value?e.style.display="block":e.style.display="none")});const s=document.getElementById("reviewForm");function d(e,t,n=null){const o={sentiment:e,platform:t,timestamp:(new Date).toISOString(),data:n};"undefined"!=typeof gtag&&gtag("event","review_action",{event_category:"engagement",event_label:`${e}_${t}`,value:"positive"===e?1:0})}s&&s.addEventListener("submit",function(e){e.preventDefault();let t=!0;if(["reviewerName","reviewerEmail","reviewTour","rating","reviewTitle","reviewContent"].forEach(e=>{const n=document.getElementById(e),o=document.getElementById(e+"-error");n&&o&&(n.value.trim()?(n.classList.remove("error"),o.textContent=""):(n.classList.add("error"),o.textContent="Это поле обязательно для заполнения",t=!1))}),t){const e=new FormData(this),t={type:"internal_feedback",reviewerName:e.get("reviewerName"),reviewerEmail:e.get("reviewerEmail"),reviewerLocation:e.get("reviewerLocation"),reviewTour:e.get("reviewTour"),customTourName:e.get("customTourName"),rating:e.get("rating"),reviewTitle:e.get("reviewTitle"),reviewContent:e.get("reviewContent"),timestamp:(new Date).toISOString()};d("negative","internal",t);alert("Спасибо за ваш отзыв! Мы получили вашу обратную связь и обязательно учтем ваши предложения для улучшения сервиса."),n()}});const l=document.getElementById("reviewModal");l&&l.addEventListener("click",function(e){e.target===this&&n()}),document.addEventListener("keydown",function(e){if("Escape"===e.key){const e=document.getElementById("reviewModal");e&&"flex"===e.style.display&&n()}})});